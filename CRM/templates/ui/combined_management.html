{% extends "base_admin.html" %}
{% block content %}
<div class="page-header">
  <div class="page-title">Manage Lead Options</div>
  <div class="quick-actions">
    <button class="btn primary" onclick="openAddStatusModal()">
      + Add Status
    </button>
    <button class="btn primary" onclick="openAddSourceModal()">
      + Add Source
    </button>
  </div>
</div>

{% csrf_token %}

<div class="management-container">

  <!-- Side by Side Layout -->
  <div class="management-grid">
    <!-- Statuses Section -->
    <div class="management-card">
      <div class="card-header">
        <h3>LEAD STATUSES</h3>
      </div>
      <div class="card-content">
        {% if statuses %}
          <div class="status-list">
            {% for status in statuses %}
              <div class="status-item" data-item-name="{{ status.name|lower }}" data-item-type="status">
                <div class="status-name">{{ status.name }}</div>
                <div class="status-actions">
                  <button class="delete-btn" onclick="deleteStatus({{ status.id }}, '{{ status.name }}')" title="Delete">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6M10 11v6M14 11v6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </button>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="empty-state">
            <div>No statuses found</div>
            <button class="btn primary" onclick="openAddStatusModal()">+ Create First Status</button>
          </div>
        {% endif %}
      </div>
    </div>

    <!-- Sources Section -->
    <div class="management-card">
      <div class="card-header">
        <h3>LEAD SOURCES</h3>
      </div>
      <div class="card-content">
        {% if sources %}
          <div class="source-list">
            {% for source in sources %}
              <div class="source-item" data-item-name="{{ source.source|lower }}" data-item-type="source">
                <div class="source-name">{{ source.source }}</div>
                <div class="source-actions">
                  <button class="delete-btn" onclick="deleteSource({{ source.id }}, '{{ source.source }}')" title="Delete">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6M10 11v6M14 11v6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </button>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="empty-state">
            <div>No sources found</div>
            <button class="btn primary" onclick="openAddSourceModal()">+ Create First Source</button>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Add/Edit Status Modal -->
<div id="statusModal" class="modal" style="display: none;">
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="statusModalTitle">Add New Status</h3>
      <button class="close-btn" onclick="closeStatusModal()">&times;</button>
    </div>
    <div class="modal-body">
      <form id="statusForm">
        <div style="margin-bottom: 15px;">
          <label for="statusName" style="display: block; margin-bottom: 5px; font-weight: 500;">Status Name:</label>
          <input type="text" id="statusName" placeholder="Enter status name..." style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 4px;" required>
        </div>
        <div style="text-align: right;">
          <button type="button" class="btn ghost" onclick="closeStatusModal()">Cancel</button>
          <button type="submit" class="btn primary">Save</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Add Source Modal -->
<div id="sourceModal" class="modal" style="display: none;">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Add New Source</h3>
      <button class="close-btn" onclick="closeSourceModal()">&times;</button>
    </div>
    <div class="modal-body">
      <form id="sourceForm">
        <div style="margin-bottom: 15px;">
          <label for="sourceName" style="display: block; margin-bottom: 5px; font-weight: 500;">Source Name:</label>
          <input type="text" id="sourceName" placeholder="Enter source name..." style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 4px;" required>
        </div>
        <div style="text-align: right;">
          <button type="button" class="btn ghost" onclick="closeSourceModal()">Cancel</button>
          <button type="submit" class="btn primary">Save</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  let currentStatusId = null;
  
  function openAddStatusModal() {
    currentStatusId = null;
    document.getElementById('statusModalTitle').textContent = 'Add New Status';
    document.getElementById('statusModal').style.display = 'block';
    document.getElementById('statusName').value = '';
  }
  
  
  function closeStatusModal() {
    document.getElementById('statusModal').style.display = 'none';
    currentStatusId = null;
  }
  
  function openAddSourceModal() {
    document.getElementById('sourceModal').style.display = 'block';
    document.getElementById('sourceName').value = '';
  }
  
  function closeSourceModal() {
    document.getElementById('sourceModal').style.display = 'none';
  }
  
  function deleteStatus(id, name) {
    if (confirm(`Are you sure you want to delete the status "${name}"?`)) {
      const formData = new FormData();
      formData.append('csrfmiddlewaretoken', document.querySelector('[name=csrfmiddlewaretoken]').value);
      
      fetch(`/ui/options/statuses/${id}/delete/`, {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          location.reload();
        } else {
          alert('Error deleting status: ' + (data.error || 'Unknown error'));
        }
      })
      .catch(error => {
        console.error('Error deleting status:', error);
        alert('Error deleting status');
      });
    }
  }
  
  function deleteSource(id, name) {
    if (confirm(`Are you sure you want to delete the source "${name}"?`)) {
      const formData = new FormData();
      formData.append('csrfmiddlewaretoken', document.querySelector('[name=csrfmiddlewaretoken]').value);
      
      fetch(`/ui/options/sources/${id}/delete/`, {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          location.reload();
        } else {
          alert('Error deleting source: ' + (data.error || 'Unknown error'));
        }
      })
      .catch(error => {
        console.error('Error deleting source:', error);
        alert('Error deleting source');
      });
    }
  }
  
  
  
  document.getElementById('statusForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const name = document.getElementById('statusName').value.trim();
    
    if (!name) {
      alert('Please enter a status name');
      return;
    }
    
    const formData = new FormData();
    formData.append('name', name);
    formData.append('sort_order', '0');
    formData.append('csrfmiddlewaretoken', document.querySelector('[name=csrfmiddlewaretoken]').value);
    
    const url = '/ui/options/statuses/create/';
    
    fetch(url, {
      method: 'POST',
      body: formData
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        closeStatusModal();
        location.reload();
      } else {
        alert('Error saving status: ' + (data.error || 'Unknown error'));
      }
    })
    .catch(error => {
      console.error('Error saving status:', error);
      alert('Error saving status');
    });
  });
  
  document.getElementById('sourceForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const name = document.getElementById('sourceName').value.trim();
    
    if (!name) {
      alert('Please enter a source name');
      return;
    }
    
    const formData = new FormData();
    formData.append('source', name);
    formData.append('csrfmiddlewaretoken', document.querySelector('[name=csrfmiddlewaretoken]').value);
    
    fetch('/ui/options/sources/create/', {
      method: 'POST',
      body: formData
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        closeSourceModal();
        location.reload();
      } else {
        alert('Error saving source: ' + (data.error || 'Unknown error'));
      }
    })
    .catch(error => {
      console.error('Error saving source:', error);
      alert('Error saving source');
    });
  });
  
  // Close modal when clicking outside
  window.onclick = function(event) {
    const statusModal = document.getElementById('statusModal');
    const sourceModal = document.getElementById('sourceModal');
    if (event.target === statusModal) {
      closeStatusModal();
    }
    if (event.target === sourceModal) {
      closeSourceModal();
    }
  }
</script>

<style>
  /* Management Container */
  .management-container {
    background: #1e293b;
    border-radius: 12px;
    padding: 24px;
    margin: 20px 0;
  }


  /* Management Grid */
  .management-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 32px;
  }

  /* Management Cards */
  .management-card {
    background: #334155;
    border-radius: 8px;
    border: 1px solid #475569;
    overflow: hidden;
  }

  .card-header {
    background: #1e293b;
    padding: 16px 20px;
    border-bottom: 1px solid #475569;
  }

  .card-header h3 {
    margin: 0;
    color: #f8fafc;
    font-size: 14px;
    font-weight: 700;
    letter-spacing: 0.05em;
    text-transform: uppercase;
  }

  .card-content {
    padding: 0;
  }

  /* Status and Source Lists */
  .status-list, .source-list {
    padding: 0;
  }

  .status-item, .source-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 20px;
    border-bottom: 1px solid #475569;
    transition: background-color 0.2s ease;
  }

  .status-item:last-child, .source-item:last-child {
    border-bottom: none;
  }

  .status-item:hover, .source-item:hover {
    background: #475569;
  }

  .status-name, .source-name {
    color: #f8fafc;
    font-size: 14px;
    font-weight: 500;
  }

  .status-actions, .source-actions {
    display: flex;
    align-items: center;
  }

  .delete-btn {
    background: #ef4444;
    border: none;
    border-radius: 6px;
    padding: 8px;
    cursor: pointer;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.2s ease;
  }

  .delete-btn:hover {
    background: #dc2626;
  }

  .delete-btn svg {
    width: 16px;
    height: 16px;
  }

  /* Empty State */
  .empty-state {
    padding: 40px 20px;
    text-align: center;
    color: #9ca3af;
  }

  .empty-state div {
    margin-bottom: 16px;
    font-size: 14px;
  }

  /* Modal Styles */
  .modal {
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.7);
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .modal-content {
    background: #1e293b;
    border-radius: 12px;
    width: 90%;
    max-width: 500px;
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    border: 1px solid #475569;
  }
  
  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 24px;
    border-bottom: 1px solid #475569;
  }
  
  .modal-header h3 {
    margin: 0;
    color: #f8fafc;
    font-size: 18px;
    font-weight: 600;
  }
  
  .close-btn {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: #9ca3af;
    padding: 4px;
    border-radius: 4px;
    transition: all 0.2s ease;
  }
  
  .close-btn:hover {
    color: #f8fafc;
    background: #475569;
  }
  
  .modal-body {
    padding: 24px;
  }

  .modal-body label {
    display: block;
    margin-bottom: 8px;
    color: #f8fafc;
    font-weight: 500;
    font-size: 14px;
  }

  .modal-body input {
    width: 100%;
    padding: 12px 16px;
    background: #334155;
    border: 1px solid #475569;
    border-radius: 8px;
    color: #f8fafc;
    font-size: 14px;
    outline: none;
    transition: border-color 0.2s ease;
  }

  .modal-body input:focus {
    border-color: #60a5fa;
  }

  .modal-body input::placeholder {
    color: #9ca3af;
  }

  .modal-body .btn {
    margin-left: 8px;
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .management-grid {
      grid-template-columns: 1fr;
      gap: 20px;
    }

    .management-container {
      padding: 16px;
      margin: 16px 0;
    }


    .modal-content {
      width: 95%;
      margin: 20px;
    }
  }

  @media (max-width: 480px) {
    .page-header {
      flex-direction: column;
      align-items: flex-start;
      gap: 16px;
    }

    .quick-actions {
      width: 100%;
      flex-direction: column;
    }

    .quick-actions .btn {
      width: 100%;
      justify-content: center;
    }
  }
</style>
{% endblock %}
