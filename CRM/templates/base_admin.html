{% load static %}
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CRM</title>
    <style>
      :root {
        --bg: #0b1220;
        --bg-soft: #0f172a;
        --card: #162338;
        --card-soft: #122033;
        --border: #1f2937;
        --text: #e5e7eb;
        --muted: #9ca3af;
        --primary: #60a5fa;
        --success: #34d399;
        --warning: #fbbf24;
        --danger: #f87171;
        --accent: linear-gradient(135deg, #6366f1, #06b6d4);
        --dash: #2a384d;
      }
      * { box-sizing: border-box; }
      body { margin: 0; background: var(--bg); color: var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; }
      .layout { display: flex; min-height: 100vh; }
      .sidebar { width: 280px; background: #1e293b; color:#fff; padding:24px; border-right:1px solid #334155; position: sticky; top: 0; align-self: flex-start; height: 100vh; display: flex; flex-direction: column; }
      .sidebar h2 { font-size:14px; color:#60a5fa; letter-spacing: .1em; text-transform: uppercase; font-weight: 700; display:flex; align-items:center; gap:12px; }
      .sidebar h2 svg { width:20px; height:20px; stroke:#60a5fa; }
      .sidebar a { color:#e2e8f0; text-decoration:none; display:block; padding:8px 0; font-size:16px; transition: color 0.2s ease; }
      .sidebar a:hover { color:#ffffff; }
      .submenu { margin-left:20px; margin-bottom:16px; }
      .separator { height:1px; background: #334155; border:0;}
      .brand { display:flex; align-items:center; gap: 12px}
      .sidebar a.brand { display:flex; align-items:center; gap:12px; padding: 0; }
      .brand img.logo { height:66px; width:auto; display:block; background: transparent; box-shadow: none; border-radius: 0; }
      .brand h1 { margin:0; font-size:32px; font-weight: 700; color: #ffffff; }
      /* Dotted guideline for nested tabs */
      .submenu { padding-left:20px; margin-left:20px; background-image: repeating-linear-gradient(to bottom, #475569 0 4px, transparent 4px 16px); background-repeat:no-repeat; background-size:1px 100%; background-position:0 0; }
      .submenu a { position:relative; padding-left:12px; color: #ffffff; font-size: 16px; }
      .submenu a:hover { color: #60a5fa; }
      
      /* Active state for current page */
      .sidebar h2 a.active { color: #60a5fa; }
      .submenu a.active { color: #60a5fa; font-weight: 600; }
      
      /* Improved hover effects */
      .sidebar h2:hover { color: #ffffff; }
      .sidebar h2 a:hover { color: #ffffff; }
              .muted { color: var(--muted); font-size:13px; }
              .content { flex:1; padding:24px; }
              
              /* Responsive Design */
              @media (max-width: 1024px) {
                .sidebar { width: 240px; padding: 20px; }
                .brand h1 { font-size: 28px; }
                .sidebar h2 { font-size: 13px; }
                .sidebar a { font-size: 15px; }
              }
              
              @media (max-width: 768px) {
                .layout { flex-direction: column; }
                .sidebar { 
                  width: 100%; 
                  height: auto; 
                  position: static; 
                  padding: 16px; 
                  border-right: none; 
                  border-bottom: 1px solid #334155;
                }
                .brand { margin-bottom: 20px; }
                .brand h1 { font-size: 24px; }
                .sidebar h2 { margin: 16px 0 8px; }
                .submenu { margin-left: 16px; }
                .content { padding: 16px; }
              }
              
              @media (max-width: 480px) {
                .sidebar { padding: 12px; }
                .brand { margin-bottom: 16px; }
                .brand h1 { font-size: 20px; }
                .brand img.logo { height: 32px; }
                .sidebar h2 { font-size: 12px; margin: 12px 0 6px; }
                .sidebar a { font-size: 14px; }
                .content { padding: 12px; }
              }
      .messages { margin-bottom:12px; }
      .messages .msg { padding:10px 12px; border-radius:10px; margin-bottom:8px; border:1px solid var(--border); }
      .messages .msg.error { background: rgba(248,113,113,.12); color:#fecaca; border-color: rgba(248,113,113,.35); }
      .messages .msg.success { background: rgba(52,211,153,.12); color:#bbf7d0; border-color: rgba(52,211,153,.35); }
      .messages .msg { transition: opacity 0.5s ease, transform 0.5s ease; }
      .messages .msg.fade-out { opacity: 0; transform: translateY(-10px); }

      .topbar { display:flex; align-items:center; justify-content:space-between; margin-bottom:18px; }
      .search { display:flex; align-items:center; gap:8px; background: var(--card); border:1px solid var(--border); padding:8px 10px; border-radius:10px; width: 360px; }
      .search input { background: transparent; border:0; outline:0; color: var(--text); width:100%; font-size:14px; }
      .quick-actions { display:flex; gap:10px; }
      .btn { background: var(--card); border:1px solid var(--border); color: var(--text); padding:8px 12px; border-radius:10px; font-size:14px; text-decoration:none; transition: background-color .15s ease, border-color .15s ease, box-shadow .15s ease, transform .08s ease; cursor: pointer; }
      .btn:hover { background: #15243a; border-color: #3b4f69; color: #f3f4f6; box-shadow: 0 4px 16px rgba(0,0,0,.35); }
      .btn:active { transform: translateY(1px); }
      .btn:focus-visible { outline: none; box-shadow: 0 0 0 3px rgba(96,165,250,.35); border-color: var(--primary); }
      .btn.primary { background: var(--accent); border:0; color: white; }
      .btn.primary:hover { filter: brightness(1.05) saturate(1.1); box-shadow: 0 2px 12px rgba(96,165,250,.35); }
      .btn.ghost { background: transparent; border:1px dashed var(--border); }
      .btn.ghost:hover { background: rgba(42,56,77,.25); border-style: solid; border-color: #2a384d; }

      .grid { display:grid; grid-template-columns: repeat(12, 1fr); gap:14px; }
      .kpi { background: var(--card); border:1px solid var(--border); border-radius:14px; padding:16px; position:relative; overflow:hidden; }
      .kpi h3 { margin:0; font-size:13px; color: var(--muted); }
      .kpi .value { margin-top:8px; font-size:26px; font-weight:600; }
      .kpi .trend { margin-top:6px; font-size:12px; }
      .chip { display:inline-block; padding:2px 8px; border-radius:999px; font-size:12px; border:1px solid var(--border); background: #0b162a; color: var(--muted); }
      .chip.pending { background: rgba(251,191,36,.15); border-color: rgba(251,191,36,.35); color:#fbbf24; }
      .chip.done { background: rgba(52,211,153,.15); border-color: rgba(52,211,153,.35); color:#34d399; }
      /* Inline status select styled like a chip */
      .status-select { appearance: none; -webkit-appearance: none; -moz-appearance: none; padding:2px 24px 2px 8px; border-radius:999px; font-size:12px; border:1px solid var(--border); background:#0b162a; color: var(--muted); cursor:pointer; background-image: linear-gradient(45deg, transparent 50%, var(--muted) 50%), linear-gradient(135deg, var(--muted) 50%, transparent 50%); background-position: calc(100% - 12px) 55%, calc(100% - 7px) 55%; background-size: 5px 5px, 5px 5px; background-repeat: no-repeat; }
      .status-select.pending { background: rgba(251,191,36,.15); border-color: rgba(251,191,36,.35); color:#fbbf24; }
      .status-select.done { background: rgba(52,211,153,.15); border-color: rgba(52,211,153,.35); color:#34d399; }

      .card { background: var(--card); border:1px solid #2a384d; border-radius:14px; padding:16px; box-shadow: 0 2px 12px rgba(0,0,0,.25); }
      .card h3 { margin:0 0 10px; font-size:14px; color: var(--muted); text-transform: uppercase; letter-spacing: .04em; }
      .row { display:grid; grid-template-columns: repeat(12, 1fr); gap:14px; }
      .span-12 { grid-column: span 12; }
      .span-8 { grid-column: span 8; }
      .span-6 { grid-column: span 6; }
      .span-4 { grid-column: span 4; }
      .span-3 { grid-column: span 3; }
      .chart { height: 220px; background: var(--card-soft); border:1px dashed var(--border); border-radius:12px; display:flex; align-items:center; justify-content:center; color: var(--muted); }
      .list { display:flex; flex-direction:column; gap:10px; }
      .list-item { display:flex; align-items:center; justify-content:space-between; background: var(--card-soft); border:1px solid var(--border); padding:10px; border-radius:10px; }
      .list-item .title { font-weight:600; }
      .list-item .meta { color: var(--muted); font-size:12px; }

      table { width:100%; border-collapse: collapse; }
      th, td { text-align:left; padding:10px; border-bottom:1px solid var(--border); font-size:14px; }
      tr:hover td { background:#0e182a; }

      /* Shared UI helpers */
      .page-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:14px; }
      .page-title { display:flex; align-items:center; gap:10px; font-size:20px; font-weight:700; }
      .toolbar { display:flex; gap:10px; margin-bottom:14px; align-items:center; }
      .input { display:flex; align-items:center; gap:8px; background: var(--card-soft); border:1px solid #2a384d; padding:8px 10px; border-radius:12px; cursor:text; }
      .input svg { pointer-events:none; }
      .input input, .input select { background: transparent; border:0; outline:0; color: var(--text); font-size:14px; flex:1; width:100%; }
      .input input::placeholder { color: var(--muted); }
      
      /* Test Email Page Styles */
      .code-block {
          background-color: var(--card-soft);
          border: 1px solid var(--border);
          border-radius: 8px;
          padding: 15px;
          font-family: 'Courier New', monospace;
          font-size: 14px;
          line-height: 1.4;
          overflow-x: auto;
          margin: 16px 0;
      }
      .code-block code {
          background-color: transparent;
          padding: 0;
          color: var(--text);
      }
      .alert {
          padding: 12px 16px;
          border-radius: 8px;
          margin: 16px 0;
          border-left: 4px solid;
      }
      .alert.warning {
          background-color: rgba(251,191,36,.15);
          border-color: #fbbf24;
          color: #fbbf24;
      }
      .form-group {
          margin-bottom: 16px;
      }
      .form-group label {
          display: block;
          margin-bottom: 6px;
          color: var(--muted);
          font-size: 14px;
      }
      .form-input {
          width: 100%;
          background: var(--card-soft);
          border: 1px solid var(--border);
          color: var(--text);
          padding: 10px 12px;
          border-radius: 8px;
          font-size: 14px;
      }
      .form-input:focus {
          outline: none;
          border-color: var(--primary);
          box-shadow: 0 0 0 3px rgba(96,165,250,.15);
      }
      .input .icon-btn { background: transparent; border: 0; padding: 0 4px; display:flex; align-items:center; color: var(--muted); cursor:pointer; }
      .input .icon-btn:hover { color: var(--text); }
      .inline-2 { display:grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 14px 16px; align-items:end; }
      .inline-2 p { margin:0; }
      .input.datetime { display:flex; align-items:center; justify-content: space-between; gap:8px; padding:0; background: var(--card-soft); border:1px solid #2a384d; border-radius:12px; margin-top: 2px; }
      .input.datetime input.form-input { border:0; padding:10px 12px; background: transparent; }
      .input.datetime select.form-input { border:0; padding:10px 12px; background: transparent; }
      .input.datetime .icon-btn { padding:0 10px; }
      .input.datetime input[type="date"], .input.datetime input[type="time"] { background: transparent; border:0; padding:6px 4px; border-radius:8px; color: var(--text); width:auto; }
      .input.datetime .divider { width:1px; height:22px; background: var(--border); }
      .form-input { width:100%; background: var(--card-soft); border:1px solid #2a384d; color: var(--text); padding:10px 12px; border-radius:12px; transition: border-color .15s ease, box-shadow .15s ease, background .15s ease; }
      .form-input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(96,165,250,.25); }
      .form-input::placeholder { color: var(--muted); }
      select.form-input { appearance: none; -webkit-appearance: none; -moz-appearance: none; background-image: linear-gradient(45deg, transparent 50%, var(--muted) 50%), linear-gradient(135deg, var(--muted) 50%, transparent 50%); background-position: calc(100% - 16px) calc(1em + 2px), calc(100% - 11px) calc(1em + 2px); background-size: 5px 5px, 5px 5px; background-repeat: no-repeat; padding-right: 32px; }
      textarea.form-input { min-height: 96px; resize: vertical; }
      .card form p { margin: 0 0 16px; }
      .card form label { display:block; color: var(--muted); font-size: 13px; margin-bottom: 12px !important; }
      .card form p > label { display:block; margin-bottom: 12px; }
      label { display:block; margin-bottom: 12px !important; }
      /* Default form elements styling to match .form-input */
      .card form input[type="text"],
      .card form input[type="email"],
      .card form input[type="tel"],
      .card form input[type="number"],
      .card form input[type="url"],
      .card form input[type="password"],
      .card form select,
      .card form textarea { width:100%; background: var(--card-soft); border:1px solid #2a384d; color: var(--text); padding:10px 12px; border-radius:12px; transition: border-color .15s ease, box-shadow .15s ease, background .15s ease; }
      .card form input:focus,
      .card form select:focus,
      .card form textarea:focus { outline:none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(96,165,250,.25); }
      .card form input::placeholder,
      .card form textarea::placeholder { color: var(--muted); }
      .card form select { appearance: none; -webkit-appearance: none; -moz-appearance: none; background-image: linear-gradient(45deg, transparent 50%, var(--muted) 50%), linear-gradient(135deg, var(--muted) 50%, transparent 50%); background-position: calc(100% - 16px) calc(1.1em), calc(100% - 11px) calc(1.1em); background-size: 5px 5px, 5px 5px; background-repeat: no-repeat; padding-right: 32px; }
      .card form textarea { min-height: 96px; resize: vertical; }
      /* Two-column grid for compact fields; title/textarea span full width */
      .form-grid { display:grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 14px 16px; }
      .form-grid > p { margin:0; }
      .form-grid > p:has(input[name="title"]) { grid-column: 1 / -1; }
      .form-grid > p:has(textarea),
      .form-grid > p:has(select[multiple]) { grid-column: 1 / -1; }
      .empty-state { display:flex; flex-direction:column; align-items:center; justify-content:center; gap:8px; color: var(--muted); padding:34px 0; }

      @media (max-width: 1200px) {
        .kpi { grid-column: span 6; }
        .span-8 { grid-column: span 12; }
        .span-4 { grid-column: span 12; }
        .search { width: 100%; }
      }
      /* Flatpickr theme: light, modern (matches reference) */
      .flatpickr-calendar { background: #f8fafc; border:1px solid #e5e7eb; box-shadow: 0 12px 32px rgba(2,6,23,.2); border-radius:14px; color: #0f172a; overflow:hidden; }
      .flatpickr-calendar .flatpickr-months { background:#ffffff; border-bottom:1px solid #e5e7eb; }
      .flatpickr-months .flatpickr-month { font-weight:600; }
      .flatpickr-weekdays { background:#ffffff; color:#475569; }
      .flatpickr-day { border-radius:10px; color:#111827; }
      .flatpickr-day:hover { background:#e2e8f0; border-color:#e2e8f0; }
      .flatpickr-day.today { background: #eef2ff; border-color:#c7d2fe; }
      .flatpickr-day.selected, .flatpickr-day.startRange, .flatpickr-day.endRange { background: #2563eb; color:#ffffff; border-color:#2563eb; }
      .flatpickr-time { border-top:1px solid #e5e7eb; background:#ffffff; }
      .flatpickr-time input, .flatpickr-time .flatpickr-am-pm { color:#0f172a; font-weight:600; }
      .numInputWrapper span.arrowUp:after, .numInputWrapper span.arrowDown:after { border-color:#475569; }
      .numInputWrapper:hover { background:#f1f5f9; }
      /* Confirm buttons */
      .flatpickr-confirm { display:flex; gap:10px; padding:12px; border-top:1px solid #e5e7eb; background:#ffffff; }
      .flatpickr-confirm .flatpickr-confirm-button { flex:1; padding:10px 12px; border-radius:10px; font-weight:600; border:1px solid #e5e7eb; background:#ffffff; color:#0f172a; cursor:pointer; }
      .flatpickr-confirm .flatpickr-confirm-button.ok { background:#2563eb; color:#ffffff; border-color:#2563eb; }
      .flatpickr-confirm .flatpickr-confirm-button:hover { filter:brightness(0.98); }
      </style>
  </head>
  <body>
    <div class="layout">
      <aside class="sidebar">
        <a class="brand" href="/">
          <img class="logo" src="{% static 'assets/img/logo.png' %}" alt="CRM logo" />
          <h1>CRM</h1>
        </a>

        <h2>
          <a href="/" style="display: flex; align-items: center; gap: 12px; color: inherit; text-decoration: none;">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 13h8L3 21V13zM3 3h8L3 11V3zM13 3h8L13 11V3zM13 13h8L13 21V13z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            Dashboard
          </a>
        </h2>

        <h2>
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 4h16M7 8h10M9 12h6M11 16h2" stroke-width="2" stroke-linecap="round"/></svg>
          Leads
        </h2>
        <div class="submenu">
          <a href="/ui/leads/">All Leads</a>
          <a href="/ui/leads/new/">New Lead</a>
        </div>

        {% if request.user.profile and request.user.profile.role|add:"0" == ROLE_EMPLOYEE_VALUE or request.user.profile and request.user.profile.role|add:"0" == ROLE_MANAGER_VALUE %}
        <h2>
          <a href="/reminders/" style="display: flex; align-items: center; gap: 12px; color: inherit; text-decoration: none;">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            Reminders
          </a>
        </h2>
        {% endif %}

        {% if request.user.profile and request.user.profile.role|add:"0" == ROLE_MANAGER_VALUE %}
        <h2>
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2M9 11a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM20 8v6M23 11h-6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          Management
        </h2>
        <div class="submenu">
          <a href="/add-employee/">Add Employee</a>
          <a href="/ui/employees/">Manage Employees</a>
          <a href="/ui/options/">Manage Lead Options</a>
          <a href="/ui/projects/">Projects</a>
        </div>
        {% endif %}

        <div style="margin-top: auto;">
          <div class="separator"></div>
          <div style="padding: 8px 0; color: #94a3b8; font-size: 14px;">
            Logged in as: {% if request.user.profile %}{{ request.user.profile.user.first_name|default:request.user.profile.user.email }}{% else %}{{ request.user.email }}{% endif %}
          </div>
        </div>
      </aside>
      <main class="content">
        {% if messages %}
        <div class="messages">
          {% for message in messages %}
            <div class="msg {{ message.tags }}">{{ message }}</div>
          {% endfor %}
        </div>
        {% endif %}
        
        <script>
          // Auto-hide success messages after 5 seconds
          document.addEventListener('DOMContentLoaded', function() {
            const successMessages = document.querySelectorAll('.msg.success');
            successMessages.forEach(function(msg) {
              setTimeout(function() {
                msg.classList.add('fade-out');
                setTimeout(function() {
                  msg.remove();
                }, 500);
              }, 5000);
            });
          });
        </script>
        {% block content %}{% endblock %}
      </main>
    </div>
  </body>
  </html>


