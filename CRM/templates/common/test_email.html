{% extends "base_admin.html" %}

{% block title %}Test Email - Lead Management System{% endblock %}

{% block content %}
<div class="page-content">
    <div class="page-header">
        <h1>Test Email Functionality</h1>
        <p>Test the email system to ensure follow-up reminders will work correctly.</p>
    </div>

    <div class="card">
        <h3>Send Test Email</h3>
        <p>This will send a test email to verify your email configuration is working correctly.</p>
        
        <form method="post" style="max-width: 400px;">
            {% csrf_token %}
            <div class="form-group">
                <label for="email">Email Address:</label>
                <input type="email" id="email" name="email" class="form-input" 
                       placeholder="Enter email address" required>
            </div>
            <button type="submit" class="btn primary">Send Test Email</button>
        </form>
    </div>

    <div class="card">
        <h3>Follow-up Reminder System</h3>
        <p>The system automatically sends follow-up reminders 2 hours before scheduled follow-up times.</p>
        
        <h4>How it works:</h4>
        <ul>
            <li>When a lead has a follow-up scheduled, the system checks every hour</li>
            <li>2 hours before the follow-up time, an email is sent to the assigned user</li>
            <li>The email includes lead details and a direct link to view the lead</li>
            <li>Emails are sent using Django's built-in email system</li>
        </ul>
        
        <h4>To test the system:</h4>
        <ol>
            <li>Create a lead with a follow-up time set to 2-3 hours from now</li>
            <li>Assign the lead to a user with a valid email address</li>
            <li>Run the management command: <code>python manage.py send_follow_up_reminders</code></li>
            <li>Or use the dry-run mode: <code>python manage.py send_follow_up_reminders --dry-run</code></li>
        </ol>
        
        <h4>Email Configuration:</h4>
        <p>Current email backend: <strong>{{ email_backend }}</strong></p>
        <p>From email: <strong>{{ from_email }}</strong></p>
        
        {% if email_backend == 'django.core.mail.backends.console.EmailBackend' %}
        <div class="alert warning">
            <strong>Development Mode:</strong> Emails are currently being sent to the console for development purposes.
            Check your terminal/console to see the email content.
        </div>
        {% endif %}
    </div>

    <div class="card">
        <h3>Manual Follow-up Reminder Test</h3>
        <p>You can also test sending follow-up reminders manually using the management command:</p>
        
        <div class="code-block">
            <code># Dry run to see what would be sent</code><br>
            <code>python manage.py send_follow_up_reminders --dry-run</code><br><br>
            <code># Actually send the reminders</code><br>
            <code>python manage.py send_follow_up_reminders</code>
        </div>
    </div>
</div>
{% endblock %}
